{% extends "base.html" %}

{% block page_title %}
  Destination | Wisata Nusantara
{% endblock %}

{% block meta %}
<script>
  $(document).ready(function(){
    // ================================ ALL ABOUT INITIATING DATA ================================
    var allData = null
    const allCategory = [
      "All",
      "Favorites",
      "Art&Culture",
      "Beach&Sea",
      "Caves",
      "Culinary",
      "Temples",
      "Forest",
      "Hills",
      "Historic",
      "Mountains",
      "Nature",
    ]
    var searchKeyword = ""
    var kategoriAktif = "All"
    
    const sideBar = [
      { name: "Home", icon: "fas fa-globe-asia", iconColor: "#CBD5E1", link: "fa-solid fa-house", linkColor: "#CBD5E1", link: "/" },
      { name: "Events", icon: "fas fa-calendar-alt", iconColor: "#CBD5E1", link: "fa-solid fa-calendar-days", linkColor: "#CBD5E1", link: "/event/" },
      { name: "Journey", icon: "fas fa-book", iconColor: "#CBD5E1", link: "fa-solid fa-book", linkColor: "#CBD5E1", link: "/journey/" },
      { name: "Story", icon: "fas fa-comments", iconColor: "#CBD5E1", link: "fa-solid fa-comments", linkColor: "#CBD5E1", link: "/story/" },
      { name: "FAQ", icon: "fas fa-question", iconColor: "#CBD5E1", link: "fa-solid fa-question", linkColor: "#CBD5E1", link: "/faq/" },
      { name: "Profile", icon: "fas fa-user", iconColor: "#CBD5E1", link: "fa-solid fa-user", linkColor: "#CBD5E1", link: "/destination/profile/" },
      { name: "Wishlist", icon: "fas fa-heart", iconColor: "#22C55E", link: "fa-solid fa-heart", linkColor: "#22C55E", link: "/destination/wishlist/" },
      { name: "Add Destination", icon: "fas fa-plus", iconColor: "#22C55E", link: "fa-solid fa-plus", linkColor: "#22C55E", link: "/destination/add/" },
      { name: "Delete Destination", icon: "fas fa-trash", iconColor: "#BD4B4B", link: "fa-solid fa-trash", linkColor: "#BD4B4B", link: "/destination/delete/" }
    ]
    // ================================ END OF INITIATING DATA ===================================

    // ================================ ALL ABOUT DESTINATION ====================================
    // Destination Card
    const destination = (destinasi) => {
      return(`
        <a href="/destination/${destinasi.pk}">
          <div class="p-4 hover:scale-105 transition duration-150 ease-in-out">
            <div class="bg-local rounded-3xl w-[200px] shadow-2xl" id="card" style="background-image:url(${destinasi.fields.foto_thumbnail_url});background-size:250px;">
              <div class="h-[210px]"></div>
              <div class="flex justify-between bg-white gap-3 items-center rounded-xl p-4 m-2 w-[185px]">
                <div>
                  <p class="font-bold text-[11px]">${destinasi.fields.nama}</p>
                  <p class="text-philippinesilver text-[9px]">${destinasi.fields.lokasi}</p>
                </div> 
                <div class="text-center">
                  <i class="fa fa-duotone fa-heart" style="font-size:24px;color:#BD4B4B"></i>
                  <p class="text-[9px]">${destinasi.fields.suka}</p>
                </div>
              </div>
              <div class="h-[1px]"></div>
            </div>
          </div>
        </a>
      `)
    }

    // GET All Destination Data
    $.ajax({
      url: "http://localhost:8000/destination/json",
      type: "GET",
      success: function(data) {
        console.log(data);
        allData = data;
        data.map((destinasi) => {
          $("#daftar-destinasi-mobile").append(destination(destinasi))
          $("#daftar-destinasi-tablet-desktop").append(destination(destinasi));
        })
      }
    })

    // Search Destination (Mobile)
    $("#search-destination-mobile").keydown(function() {
      searchKeyword = $(this).val();
      showResult();
    })

    // Search Destination (Tablet & Desktop)
    $("#search-destination-tablet-desktop").keydown(function() {
      searchKeyword = $(this).val();
      showResult();
    })

    // ================================ END OF DESTINATION ================================

    // ================================ ALL ABOUT CATEGORY ================================
    allCategory.map((category) => {
      $("#kategori-mobile").append(`
        <div class="kategori" id=${category}>
          <button class="bg-black text-white text-[12px] rounded-3xl px-4 py-2 hover:bg-bone hover:drop-shadow-2xl hover:text-black focus:drop-shadow-2xl focus:bg-bone focus:text-black focus:font-bold transition duration-150 ease-in-out">${category}</button>
        </div>
      `)
      $("#kategori-tablet-desktop").append(`
        <div class="kategori" id=${category}>
          <button class="bg-black text-white text-[12px] rounded-3xl px-4 py-2 hover:bg-bone hover:drop-shadow-2xl hover:text-black hover:font-bold focus:drop-shadow-2xl focus:bg-bone focus:text-black focus:font-bold transition duration-150 ease-in-out">${category}</button>
        </div>
      `)
    })

    // IF CATEGORY CLICKED
    $(".kategori").click(function() {
      kategoriAktif = $(this).attr("id");
      $("#info-kategori-mobile").html(`
        Category : ${kategoriAktif}
      `)
      $("#info-kategori-tablet-desktop").html(`
        Category : ${kategoriAktif}
      `)
      showResult();
    })
    // ================================ END OF CATEGORY ===================================

    // ================================ RESULT SHOW =======================================
    const showResult = () => {

      const filteredData = allData.filter((destinasi) => {
        return kategoriAktif == "All" ? true : destinasi.fields.kategori.toLowerCase().includes(kategoriAktif.toLowerCase());
      }).filter((destinasi) => {
        return searchKeyword == "" ? true : destinasi.fields.nama.toLowerCase().includes(searchKeyword.toLowerCase())
      });

      $("#daftar-destinasi-mobile").html("");
      $("#daftar-destinasi-tablet-desktop").html("");

      filteredData.map((destinasi) => {
        $("#daftar-destinasi-mobile").append(destination(destinasi))
        $("#daftar-destinasi-tablet-desktop").append(destination(destinasi));
      })

      // Jika kosong
      if (filteredData.length == 0 && search != "") {
        $("#daftar-destinasi-not-found-tablet-desktop").html(`
          <div class="flex justify-center items-center">
            <p class="my-32 text-[48px] text-gray-700 font-montserrat font-bold">No destinations found :(</p>
          </div>
        `);
      } else {
        $("#daftar-destinasi-not-found-mobile").html("");
        $("#daftar-destinasi-not-found-tablet-desktop").html("");
      }

    }
    // ================================ END OF RESULT SHOW =================================
  })
</script>
{% endblock %}

{% block content %}
<!-- MOBILE -->
<div class="tablet:hidden bg-gradient-to-r from-green-500 to-slate-500">
  <div>
    <div class="p-4">
      <p>Hello, {{ username }}!</p>
      <p class="font-bold text-xl py-2">Where do you want to go?</p>
      <input type="text" name="search-destination" id="search-destination-mobile" placeholder="Search destination name" size="30" class="py-2 px-2 rounded-xl"/>
      
      <p class="font-bold text-lg py-2" id="info-kategori-mobile">Categories</p>
      <div class="flex gap-3 overflow-x-auto" id="kategori-mobile"></div>

    </div>

    <div>
      <div id="daftar-destinasi-mobile" class="flex overflow-x-auto"></div>
      <div id="daftar-destinasi-not-found-mobile"></div>
    </div>

  </div>

  <div class="flex justify-between bg-black rounded-tr-3xl rounded-tl-3xl pt-6 pb-8 px-10 mt-3">
    <a href="">
      <i class="fa-solid fa-house" style="font-size:20px;color:white"></i>
    </a>
    <a href="">
      <i class="fa-solid fa-calendar-days" style="font-size:20px;color:white"></i>
    </a>
    <a>
      <i class="fa-solid fa-heart" style="font-size:20px;color:white"></i>
    </a>
    <a>
      <i class="fa-solid fa-plus" style="font-size:20px;color:white"></i>
    </a>
    <a>
      <i class="fa-solid fa-user" style="font-size:20px;color:white"></i>
    </a>
  </div>
</div>

<!-- TABLET & DESKTOP -->
<div class="mobile:hidden tablet:block bg-gradient-to-r from-green-500 to-slate-500">
  <div class="flex">
    <div class="bg-zinc-900 px-8 py-4 cursor-pointer w-[250px]">
      <a href="/" class="text-slate-300 hover:text-bone">
        <div class="flex items-center pb-1 pt-3">
          <i class="fa-solid fa-house" style="font-size:14px;color:#CBD5E1;"></i>
          <p class="pl-2">Home</p>
        </div>
      </a>
      <a href="/event/" class="text-slate-300 hover:text-bone">
        <div class="flex items-center py-1">
          <i class="fa-solid fa-calendar-days" style="font-size:14px;color:#CBD5E1;"></i>
          <p class="pl-2">Events</p>
        </div>
      </a>
      <a href="/journey/" class="text-slate-300 hover:text-bone">
        <div class="flex items-center py-1">
          <i class="fa-solid fa-book" style="font-size:14px;color:#CBD5E1;"></i>
          <p class="pl-2">Journey</p>
        </div>
      </a>
      <a href="/story/" class="text-slate-300 hover:text-bone">
        <div class="flex items-center py-1">
          <i class="fa-solid fa-comments" style="font-size:14px;color:#CBD5E1;"></i>
          <p class="pl-2">Story</p>
        </div>
      </a>
      <a href="/faq/" class="text-slate-300 hover:text-bone">
        <div class="flex items-center py-1">
          <i class="fa-solid fa-question" style="font-size:14px;color:#CBD5E1;"></i>
          <p class="pl-2">FAQ</p>
        </div>
      </a>
      <a href="/destination/profile/" class="text-slate-300 hover:text-bone">
        <div class="flex items-center py-1">
          <i class="fa-solid fa-user" style="font-size:14px;color:#CBD5E1;"></i>
          <p class="pl-2">Profile</p>
        </div>
      </a>
      {% if is_loggedin %}
      <a href="/destination/wishlist/" class="text-slate-300 hover:text-bone">
        <div class="flex items-center pt-8 pb-1">
          <i class="fa-solid fa-heart" style="font-size:14px;color:#22C55E;"></i>
          <p class="pl-2">Wishlist</p>
        </div>
      </a>
      <a href="/destination/add/" class="text-slate-300 hover:text-bone">
        <div class="flex items-center py-1">
          <i class="fa-solid fa-plus" style="font-size:14px;color:#22C55E;"></i>
          <p class="pl-2">Add Destination</p>
        </div>
      </a>
      {% endif %}
      {% if is_admin %}
      <a href="/destination/delete/" class="text-slate-300 hover:text-bone">
        <div class="flex items-center py-1">
          <i class="fa-solid fa-trash" style="font-size:14px;color:#BD4B4B;"></i>
          <p class="pl-2">Delete Destination</p>
        </div>
      </a>
      {% endif %}
    </div>

    <div>
      <div class="pl-8 pt-6 pb-4">
        <p>Hello, {{ username }}!</p>
        <p class="font-bold text-xl pb-3">Where do you want to go?</p>
        <input type="text" name="search-destination" id="search-destination-tablet-desktop" placeholder="Search destination name" size="40" class="shadow-3xl py-2 px-2 rounded-xl"/>
        
        <p class="font-bold text-lg py-3" id="info-kategori-tablet-desktop">Categories</p>
        <div class="flex gap-3 flex-wrap" id="kategori-tablet-desktop"></div>

      </div>

      <div>
        <div id="daftar-destinasi-tablet-desktop" class="flex flex-wrap"></div>
        <div id="daftar-destinasi-not-found-tablet-desktop"></div>
      </div>

      <div class="h-[200px]"></div>
    </div>

  </div>
</div>
{% endblock %}